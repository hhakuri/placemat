{
   "ignition": {
      "version": "2.1.0"
   },
   "networkd": {
      "units": [
         {
            "contents": "[NetDev]\nName=node0\nKind=dummy\n",
            "name": "10-node0.netdev"
         },
         {
            "contents": "[Match]\nName=node0\n\n[Network]\nAddress=10.69.0.197/32\n",
            "name": "10-node0.network"
         },
         {
            "contents": "[Match]\nName=eth0\n\n[Network]\nLLDP=true\nEmitLLDP=nearest-bridge\nAddress=10.69.1.5/26\n",
            "name": "10-eth0.network"
         },
         {
            "contents": "[Match]\nName=eth1\n\n[Network]\nLLDP=true\nEmitLLDP=nearest-bridge\nAddress=10.69.1.69/26\n",
            "name": "10-eth1.network"
         }
      ]
   },
   "passwd": {
      "users": [
         {
            "groups": [
               "sudo",
               "docker"
            ],
            "name": "cybozu",
            "passwordHash": "$6$rounds=4096$m3AVOWeB$EPystoHozf.eJNCm4tWyRHpJzgTDymYuGOONWxRN8uk4amLvxwB4Pc7.tEkZdeXewoVEBEX5ujUon9wSpEf1N."
         }
      ]
   },
   "storage": {
      "files": [
         {
            "contents": {
               "source": "data:,rack1-cs2"
            },
            "filesystem": "root",
            "mode": 420,
            "path": "/etc/hostname"
         },
         {
            "contents": {
               "source": "data:,%5BResolve%5D%0ADNS%3D8.8.8.8%0ADNS%3D8.8.4.4%0A"
            },
            "filesystem": "root",
            "mode": 420,
            "path": "/etc/systemd/resolved.conf"
         }
      ]
   },
   "systemd": {
      "units": [
         {
            "contents": "[Unit]\nBefore=local-fs.target\n\n[Mount]\nWhat=/dev/vdb1\nWhere=/mnt/containers\nType=vfat\nOptions=ro\n",
            "name": "mnt-containers.mount"
         },
         {
            "contents": "[Unit]\nAfter=mnt-containers.mount\nRequires=mnt-containers.mount\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/bin/sh /mnt/containers/rkt-fetch\n",
            "name": "rkt-fetch.service"
         },
         {
            "contents": "[Unit]\nBefore=local-fs.target\n\n[Mount]\nWhat=/dev/vdc1\nWhere=/mnt/bird\nType=vfat\nOptions=ro\n\n[Install]\nWantedBy=local-fs.target\n",
            "enabled": true,
            "name": "mnt-bird.mount"
         },
         {
            "contents": "[Unit]\nAfter=mnt-bird.mount\nConditionPathExists=!/etc/bird\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/cp -r /mnt/bird /etc/bird\nRemainAfterExit=yes\n",
            "name": "copy-bird-conf.service"
         },
         {
            "contents": "[Unit]\nAfter=mnt-containers.mount\nAfter=usr.mount\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/mount --bind -o ro /mnt/containers/bashrc /usr/share/skel/.bashrc\n\n[Install]\nWantedBy=multi-user.target\n",
            "enabled": true,
            "name": "copy-bashrc.service"
         },
         {
            "contents": "[Unit]\nDescription=bird\nAfter=copy-bird-conf.service\nWants=copy-bird-conf.service\nAfter=rkt-fetch.service\nRequires=rkt-fetch.service\n\n[Service]\nSlice=machine.slice\nExecStart=/usr/bin/rkt run \\\n  --volume run,kind=empty,readOnly=false \\\n  --volume etc,kind=host,source=/etc/bird,readOnly=true \\\n  --net=host \\\n  quay.io/cybozu/bird:2.0 \\\n    --readonly-rootfs=true \\\n    --caps-retain=CAP_NET_ADMIN,CAP_NET_BIND_SERVICE,CAP_NET_RAW \\\n    --name bird \\\n    --mount volume=run,target=/run/bird \\\n    --mount volume=etc,target=/etc/bird \\\n  quay.io/cybozu/ubuntu-debug:18.04 \\\n    --readonly-rootfs=true \\\n    --name ubuntu-debug\nKillMode=mixed\nRestart=on-failure\nRestartForceExitStatus=SIGPIPE\n\n[Install]\nWantedBy=multi-user.target\n",
            "enabled": true,
            "name": "bird.service"
         },
         {
            "contents": "[Unit]\nAfter=mnt-bird.mount\nConditionPathExists=/mnt/bird/setup-iptables\n\n[Service]\nType=oneshot\nExecStart=/bin/sh /mnt/bird/setup-iptables\n\n[Install]\nWantedBy=multi-user.target\n",
            "enabled": true,
            "name": "setup-iptables.service"
         },
         {
            "contents": "[Unit]\nAfter=network.target\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/ip route add 0.0.0.0/0 nexthop via 10.69.1.1 dev eth0 nexthop via 10.69.1.65 dev eth1\n\n[Install]\nWantedBy=multi-user.target\n",
            "enabled": true,
            "name": "setup-route.service"
         }
      ]
   }
}
